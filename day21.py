import util

example_input = """
...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........
"""

input_str = """
...................................................................................................................................
...##..##......#...###.....###...#..............#.......................#....................#.#.#........#.............#..........
.#..........#...#.#..#....#.#........#.....#..#...........#..................................#.....#.............#..#.#.#.....##...
..#....#...................#..........#....#..........#.#..........................#.............#.#.#..............#.#............
....#...#............#....#.#.#..#.........#..#......#..#....................#..#.#.............##............#.............##.....
..........#............##..#....#.#.............................#.................#....##.##.##....#...##..#.....#.....#.....#.....
......#..#...#.#..............#.#......#.#.......#....#........##..#.......#.#.#.....#......#..#.#..#.......#.........##...........
...#..#..............#....#.#.......#......#....#.....#.............#........................#.......#..#........#..........##.....
...#....#...#..#..#.....#..#....#.#...#.....#...................#.............#...#.....#..#..#..#.........#.....#.......#.........
....#....#.......##..........#............#..#.......................................#.#......#.#...#.....#...#........#...#.......
.....#...###....#....#...#..............#.........................#.##......................##..#..#.#.##.........#...#............
...........#.......#.......#.....#...............#................#.#..##...........##..#.......###.#.#..#...#.#..........#........
..#......###..........#.#.......#..#..#..##....#...................#....#........###..#.#.....#...........#..............#..#....#.
....#.........#.#....#.........#..#.#.....#...#.........#..#........#...................#....#.#....#..#.#.....#....#...##..#.##...
....#..#....#.............#.......#.#...#..............#..........#....#...#........##...#.......#.........#.##............##......
.......#.#...........#....#...................................#....#........#...........#.#.###...#.........#.##.#....#...#.#..##..
....#..#........#..#..#.#..#.........#......#.............#..............#..................#.....#.#.....#..#.........#...#.......
........##...##..#......##...........#.................#.....###..#....#...#..........#.#..............#..#......................#.
.#............#.......##...........#.....................#.........#.........................##.....#..###.....#...#..###........#.
...........##...#............#......#.................#.....#..#...#...#.......#.........#..##.........#....###.....#.#......##..#.
.#....##.......#.......#...#..##..#.#...#............#.#...#......#...........................#.........#........#.........##......
..#...#...##.#.......................##...........#..#........#.#.....##..#.##.#..#.......#..#.....#.####.#.......#......#.........
.....#.##.#...##.#...........#.................#.....#....#.#..#.......#.........................#.#......#.##..#....#.#........#..
.....##.###..#...................#.........................#..#....#..#....................................#..##..#.#...#..#..#.#..
.#......#.#......#.............#.##..#.........##...##..........#.........#..#...#.#...........#.....##.......#.............##.#...
....#..........#.#....#...#.#....................#.###.........#......##...#.........#............#........#....#..#....##.#...##..
.............##.....#...#...#......#.............#............##.....#.......#.#........................#..#..........#...#........
..#......##............#...#.........................##..##..............#..#......#.................##........#...............##..
..#.......#...#......#...................#........#..#...##............##..#.....#..........................#.#..........#.........
...##..#...##..........##....###.........#.......##..................#.......#....................#...........#.#........#.........
......#....#......#.......#...#....................#..#........#..#......#..#.#....##.........................#.#....#.#....#....#.
.....#......................#................#......##......##.#.........#..##.........#...............##.......#.........#........
.#.#......#.#....#..#...#..............#......#..#.#.....#..........##.....#..#........#...#.#.........#..#.....................#..
...#.##.#..#..#...#.#................###....................##.....#.#....#.........#......#..#..........##.#....#......#..#.......
...#.................#.............#................#.................###..............#.................#..#......#.....#......##.
.#.#.....#..#..........#...........#.#............#.##..#......#..##....#.#..###.......##.#.....#.........##...#.#...........#.....
..#...#................#....................#..#..........#...............#.....#..#..####................#...............#........
..........#..........#..............#........#...##...............#.....#...#...#..##.....#...#...........##.#.....##.#......#.....
....#......#.......#...#.......#........#....#.....#..............#....#..##..#......#........#...............#.................#..
.#.............#...............#...............#..#...#..#.#...#..#.......#....................#....#........#..##........#........
.....................................#....###....#...#.....##.#.......#.........#.#.....#........#...........#...........##......#.
.......#.##...#..............#..##..#...#...........#.##..##..#....#..#.........#........#.#.....................#.......#.......#.
..#......##...................#..........#........##.....#..........#...#.#....#.#....#............##..............#...#.#.#.......
...#.#.##.#.#.......................##......#.......#.........#.........#..........#........#.#.....#.#.............#.........#....
.#.#...........#..................#....#......#.#............#....#.#..#...#..#..##.#............................#.#........#.##...
..#...#....#...................#....#..........#.......................#.....##..#...#.#.#.......#...#..#.........#......##........
.......#.................#...#........#....#.................#......................#...#.........##..................#......#.....
..#..#....#..#...............#................#..#.#.....#.#..#.........###.......................#.#..#....#..........#...........
......#...#..#...........#......................#..#............................#.....#........#.....##...#............#...........
...........................##..#....#....#.....#....#....#...#........#.......#.........#.#..........##...#..................#..#..
......#.....................#.....#.......#.#.....#.............#....#...#......#....#..#..........#........#...........#..........
..#...#.............#..............#.#....#....#.....#....#...#.#......#.....#.#...........#.#.........#.#..................#..###.
..#..............#....##......#.##..................#...##.........#..........#.................#..........#...................#...
................#.##...#......##.........#.#...#..####.#.............#...#....#.........#.................................#........
....#..........................#.......#...............#......#.......#...###.##.....#.#.#....#..###....#...#...##...........##....
...#.#...............#..................#.........#...#.#..............#.....#.......#...#.##...#..#.......#.....#...........#.....
.....#.....................#.#.#.....#.#.....#..#..##...#.....#...........#...##........#..#.......#.#...#....#..#............#....
..#..........#....##..#.....###.#...............................#.#.##.#...#....##........#...#.....#....#............#.......#....
.#...........#...#..#.....#..........#............#.......##......#.................#.#...#..##........#...............#...........
.#................#........##.#.#.....#.#.............#.....#..#..##...............#..#................#.......#...#...##.......##.
.#........#.##........##..#.#.##.....#..###..#......##...#......#..........#...............#.....#....#......#.....................
............#.........#..............#.....#..#......................#...#.##.##...###..#..........###........###..................
...........#...##.............#......#.....#.#...#...#.#..#....#..#............#....#..#.....#.#.........#.....#..#.###....#.......
.........#........#.......#..#..##..#........#.#.#...........#....................##..#....#..#.....##.......##...##...............
.......#....##..........##.....#...##....#.........#..#...................#......###.....#........#.....................#.#.#......
.................................................................S.................................................................
.....#...........#...#....#...#..#.........#.......##.#.............................#...#....#......#......#...#.#......#....#.....
........###...#.......................#...........#.....#.#.........#.#......#...#.....#..#...###.....#.#....#..........#..........
...............#.#............#.#......#...#..#.......#..#.#..#....##.#..#....#...............#.##.#..#...#...#..#.................
.............#.##..........#........#.#........###.....#..............#.......#..........##...........#........#...#...............
...........#.#.#........#......###.....#.#......#.#..##..#..#...#...##.#.#...##.......#........#..#.#.##...###...........#.........
..........##..............#......#.............#..#.#....#..#.....#.#...#..........##............#...#.##.....#.#..#...............
.#.#...............#.#............##.......#...#..#....#.....#........#.#..###...#.....#.........#................#..#.............
.............#...#........#....#....#..........##.#....#......#.....#.........#..#........#.......###....#.#....#....##............
...#............#.#......#...#....#..............#.....#..##....#.....#....#.....#...#...#.#..#.........#.#.........#..............
..............#.......#...........#..............#.#.......#..#.#......#...##.......#................#...#.....#...#...............
...##...........................#...#...#.......#............#.#.....#...#....#..#......#..#.##....#.#...#...#.................#.#.
...#....#...........#.........##...#............#...............#...................................##..#......#..#..............#.
...##.#.#.............#....#.##.#........#.....#.#...#.....##...........#.....................#...#..#......#............##.....#..
...#..#...#...............#.#......#....#.#.#......#...................#......#.....##....#....#....##...#......#..............#...
......#..#.........#.................#...#................#.........#..................................................#....#......
.#..........#..........#..................#.#...#....#....#.#.........#..#...#........#......#.............#....................#..
........#............#........#.......##......##....#................#.......#....#.#.....#............#.#.#...............###.....
.##........#..........#...#......##..#.##.#.....##.........................#.....##.#...#......#.#......#..#..........#............
....#....................#...#.......#...#.......#.....#......#...#..#...#......#.#..#...##.##..#.....##...........#..#.###........
.#.....#........#..............#...#...#.........#.#................#.#.............##.#....#..#.....................#.....#..###..
......#...#.#..#.............##.#........#.....................#........#....#...........#....##......................#............
..#.....##...#..#.#.........#.#.......#.#..#......#..........#.##....#..#..................#.........#..#........#....##...........
..#...#.#....#.#...................##......##...........#...#.............#..........#.##..#.#......#..................#..#.#...##.
...##...#........#.#.........#...#.....#.#...##...#...#..#.#.........#.....#..#....#.###...#........#.............#.........#....#.
.........#...#.#...#.#.................#............#........................#.#.....#.........#................#.....#..#......#..
...........#.#..#.............##........#..........#....#...........#....#.....#....#....#.#......##.........#..##....#..##........
.........#..................................#..#...............#...#..#...#...#..#......#.#..#.............#...........#.#..#...##.
.#.#......#..#.......#.##........#......#....#................#...#...##..##....#.....#..........#.........#....#..#.#.........#...
.....#.....#.........#............#....#.....................#....#.##...#......................#................#.#.#...#.........
.....#.............##..#..........#..#..............##..#.................##........###.....#.#.........#.#.#...............#......
.#.#.#...#.#..............#...............#...............#..#.....#......#..............................#.......#.#...#.#...#.....
.................#........#...............#.........................................#......................#....#............#...#.
.#...#.###...........#...#..##...............#.........#...##....................#...........#...............#....##...........#.#.
..###...#.#.........##.................#.#.....#..##...........#....##........#...#...................##..##...#................#..
...#.................#.....#...........#....#...##...#.......#............#.....#.#........#........#...#...##...#.##..............
.......#....#.........#.#.....#.#.......#.....#....#...#.............#.....#.....#.##.....................#.###...........#........
................#....#..#.......#.............#......#.......#.................#.#................#..........#.....##...#..#....#..
........#...#...#.#......##......#.........#.......................#.........#...#.....................#..........#.#..#...#.......
....#.......##......##....##.................#.....#.#.#....#...#...........#.......................#........#....#....#.....#...#.
.#..##..##.........#......#.........#.......#....#....#...#.....#..#.....#.#............................#...#..................#.#.
...#......#............##.....##.............##.................#..#....#.#...#....#......................##....#.....#........#...
........#....#....#..........#.###....#................#..##......#..#...#..#......#..........##...............#..#.........#...#..
.....#...#.##.....#....#.##.........#............##....#..#.#.....#.............#...................#..#............#..#..#.#....#.
.....#..#.........##..#...........#....#............#.#...........#..............##.......#.#...........#..####.....##.#.##........
...#.#.#.##.#.#..#.....#........###..#............#........##......##.#..........................####........##.#.....#......#.....
.##.#.#...##..#........##....#........#............#...#...#......#....#....##..#...........#.#.........#.##...#...#...#...#.#.....
......#.#..#.#........##.#....#.#...#.###..#...........#...................#.................#.#.#............##.#...#.#.........#.
........#.#....#...#...#..........#.#..#..#...........#..#...#.....##......#.....................##..#........#.....#.#.....#....#.
..#.......##....##............##...............................#......#.#..#.............#..........................#....#.........
.......#....#................#...........#...##................#...#.#....#...............#....##.......................#.#.....#..
..........#...........#..#..#.....#...........##...........#......#.#.#.#..........#..........#.....#......................###.....
....#.......##...........#..........#..###.#.........................#....#..........#.#.........#......#............#..#.....#..#.
...#.#...#...#.............#.......#...#.##..............................#........##.......##..#...#......................#........
...........##.............#....##....#.#...#.#..............#..#..................#.......#......#.......#.................#..#....
.#.##..#......#...#..#........#.......#.#.#....#...............#........................#..........#...............................
........#...........#....#...#...##..#.#....###................#...#.................#..................#.......#....#........#..#.
.........#.###.#....#..#..##..........#.#.......#............................#..##....#.....#....#....#.#...##......##.............
..#.#..##.#........#..#.#...#........#...#...#.....................##...........#.....#...#.#.#...#.......#..#..#.........#..#..#..
.....#..........####....##..##......#.............#...#...........#........#..........#.............###...#.#.#...#................
..#.....#...#....#.#.........#....#..#.......##.....#.............#........#............#...###.........#...#......................
.##..............#..#....#..#......#....##..#......#.###.#..................#...............#.#..#..#.##..........#............#.#.
..#..#..#.....................#.#..............##...#.....#....................#..##...#.........#...........#..##.........#....#..
....#...............#.......#.#....##....#..#..........................#.......#.##...........#.......#....#.#........#..#.........
.....##.......#.................................#........#..................#..#.#......#....#..#....#...#.........................
...................................................................................................................................
"""

def get_next_tiles(pos: tuple[int, int], grid: util.Grid):
    y, x = pos
    n = [
        (y + 1, x),
        (y - 1, x),
        (y, x + 1),
        (y, x - 1)
    ]
    return [p for p in n if grid.get(p) == "." or grid.get(p) == "S"]


def find_tiles(grid: util.Grid):
    start = [p for p in grid if grid[p] == "S"]

    def find_tiles_rec(steps: int, tiles: list[tuple[int, int]]):
        if steps == 64:
            return tiles
        possible = []
        for p in tiles:
            possible.extend(get_next_tiles(p, grid))
        return find_tiles_rec(steps + 1, list(set(possible)))
    
    return find_tiles_rec(0, start)


def debug(grid: util.Grid, steps: set):
    h, w = sorted(grid.keys())[-1]
    output = []
    for y in range(0, h + 1):
        row = []
        for x in range(0, w + 1):
            if (y, x) in steps:
                row.append("O")
            else:
                row.append(grid[(y, x)])
        output.append("".join(row))
    d = "\n".join(output)
    return d


def part1():
    lines = util.get_lines(input_str)
    grid = util.lines_to_grid(lines)
    tiles = find_tiles(grid)
    return len(tiles)


print("Part 1", part1())
